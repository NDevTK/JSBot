# JS Security Analysis Framework

This project is a comprehensive, multi-stage framework for discovering, scanning, and analyzing JavaScript code for security vulnerabilities. It moves beyond a single script into a full-fledged, database-driven system that allows for continuous, stateful security reconnaissance and a CLI-based workflow for external agent review.

Its primary purpose is to serve as a complete pipeline for security research, from target discovery to final reporting.

## System Overview

The framework is composed of several distinct Python scripts that work together, using a central SQLite database (`js_security.db`) to manage state. The workflow is as follows:

1.  **Target Ingestion**: New target domains are added to a central work queue using `add_urls.py` or discovered automatically using `scope_expansion.py`.
2.  **Scanning**: The `scan.py` engine runs continuously, pulling URLs from the queue, crawling them, finding JavaScript files, and logging any potential findings from its pattern-based analysis into the database.
3.  **Manual Review**: An external agent (e.g., a human security analyst) uses the `agent_review.py` interactive CLI to examine each pending finding. The tool displays the code and context, and the agent provides a structured JSON verdict on its exploitability.
4.  **Reporting**: The `report.py` script generates a clean, human-readable report of all findings that the agent has confirmed as exploitable.
5.  **Feedback Loop**: The `feedback_loop.py` script automatically finds new targets by analyzing the code of confirmed high-priority vulnerabilities, creating a self-improving system.

## Installation

The framework requires Python 3.8+ and several external libraries.

#### 1. Python Dependencies

You can install all required Python libraries using the provided `requirements.txt` file:
```bash
pip install -r requirements.txt
```

#### 2. External Tools

The `scope_expansion.py` script relies on the `subfinder` tool from ProjectDiscovery. You must install it and ensure it is available in your system's `PATH`.
*   Installation instructions can be found here: [https://github.com/projectdiscovery/subfinder](https://github.com/projectdiscovery/subfinder)

## Usage & Workflow

Here is a step-by-step guide to using the framework.

#### Step 1: Initialize the Database

Before running any other script, initialize the SQLite database:
```bash
python database.py
```
This will create the `js_security.db` file in your directory.

#### Step 2: Add Targets to the Queue

You can add targets in two ways:

*   **Manually**: Create a text file with one URL or domain per line and use `add_urls.py`.
    ```bash
    # urls.txt contains domains like "example.com"
    python add_urls.py urls.txt
    ```
*   **Automatically**: Use `scope_expansion.py` to find subdomains and historical URLs for a root domain.
    ```bash
    python scope_expansion.py example.com
    ```

#### Step 3: Run the Scanner

The scanner runs in batches, processing URLs from the queue. You can run this script periodically.
```bash
python scan.py
```

#### Step 4: Review Findings

To review the findings generated by the scanner, run the interactive agent review CLI. The script will present one finding at a time and prompt you to submit a verdict.
```bash
python agent_review.py
```

Follow the on-screen prompts to enter your JSON verdict.

#### Step 5: Generate Reports

To see a report of all findings you have marked as exploitable, run:
```bash
python report.py
```

#### Step 6: Run the Feedback Loop (Optional)

To automatically find new targets from your confirmed findings, run:
```bash
python feedback_loop.py
```

## Script Details

*   `database.py`: Defines the SQLite database schema and contains all data access functions. Used by all other scripts.
*   `add_urls.py`: A CLI tool to add new URLs to the work queue from a file.
*   `scope_expansion.py`: A CLI tool to find subdomains and historical URLs for a given domain and add them to the queue.
*   `scan.py`: The core scanning engine. Fetches URLs from the queue, crawls them, and saves scripts and findings to the database.
*   `agent_review.py`: An interactive CLI for an external agent to review findings and submit verdicts.
*   `report.py`: A CLI tool to generate a summary report of all confirmed vulnerabilities.
*   `feedback_loop.py`: A script that finds new targets by analyzing confirmed findings.
*   `manual_verdict.py`: A utility script for testing; not part of the main workflow.
*   `test_urls.txt`: A utility file for testing; not part of the main workflow.
